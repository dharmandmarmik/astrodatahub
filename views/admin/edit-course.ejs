<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title><%= title %> - AstroDataHub</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <style>
        .form-container { max-width: 600px; margin: 40px auto; padding: 30px; }
        .editor-container { margin-bottom: 20px; }
        #courseDescriptionEditor {
            height: 250px;
            background: white;
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
        }
        .market-section { 
            background: #f8fafc; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 20px 0; 
            border: 1px solid #e2e8f0;
        }
        .price-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; }
        .btn-delete { background-color: #e74c3c !important; color: white !important; font-weight: 500; border: none; padding: 10px 18px; border-radius: 6px; cursor: pointer; transition: background-color 0.2s; }
        .btn-delete:hover { background-color: #c0392b !important; }
    </style>
</head>
<body>
    <header class="app-header">
        <h1>Admin: Edit Course</h1>
        <nav>
            <span class="welcome-message">Admin: <%= adminUser.username %></span>
            <a href="/admin/manage-courses" class="btn-header">‚Üê Manage Courses</a>
            <form action="/auth/logout" method="POST" style="display:inline;">
                <button type="submit" class="btn-header btn-logout">Logout</button>
            </form>
        </nav>
    </header>

    <main class="form-container container">
        <h2>Editing: <%= course.title %></h2>
        
        <% if (error) { %>
            <p class="error"><%= error %></p>
        <% } %>
        <% if (success) { %>
            <p class="success"><%= success %></p>
        <% } %>

        <form action="/admin/edit-course/<%= course.id %>" method="POST" id="courseForm">
            
            <input type="text" name="title" placeholder="Course Title" value="<%= course.title %>" required>
            
            <select name="subject" required>
                <% ["Mathematics", "Astronomy", "Physics", "Chemistry", "Computer Science"].forEach(sub => { %>
                    <option value="<%= sub %>" <%= course.subject === sub ? 'selected' : '' %>><%= sub %></option>
                <% }) %>
            </select>

            <select name="standard" required>
                <optgroup label="Competitive (India)">
                    <% ["IIT-JEE", "NEET", "Olympiad"].forEach(std => { %>
                        <option value="<%= std %>" <%= course.standard === std ? 'selected' : '' %>><%= std %></option>
                    <% }) %>
                </optgroup>
                <optgroup label="Schooling">
                    <% for(let i=1; i<=12; i++) { %>
                        <option value="Class <%= i %>" <%= course.standard === 'Class ' + i ? 'selected' : '' %>>Class <%= i %></option>
                    <% } %>
                </optgroup>
                <optgroup label="International">
                    <% ["IB Diploma", "IGCSE", "SAT/ACT"].forEach(std => { %>
                        <option value="<%= std %>" <%= course.standard === std ? 'selected' : '' %>><%= std %></option>
                    <% }) %>
                </optgroup>
                <optgroup label="Higher Ed">
                    <% ["Bachelors", "Masters", "PhD / Doctorate"].forEach(std => { %>
                        <option value="<%= std %>" <%= course.standard === std ? 'selected' : '' %>><%= std %></option>
                    <% }) %>
                </optgroup>
                <optgroup label="Specialized">
                    <option value="Research" <%= course.standard === 'Research' ? 'selected' : '' %>>Research & Thesis</option>
                </optgroup>
            </select>
            
            <select name="level" required>
                <option value="Beginner" <%= course.level === 'Beginner' ? 'selected' : '' %>>Beginner</option>
                <option value="Intermediate" <%= course.level === 'Intermediate' ? 'selected' : '' %>>Intermediate</option>
                <option value="Expert" <%= course.level === 'Expert' ? 'selected' : '' %>>Expert</option>
            </select>

            <div class="market-section">
    <label style="font-weight: bold; display: block; margin-bottom: 5px;">Target Audience & Localization</label>
    <select name="country_code" required>
        <% 
        const countries = [
            {code: 'GLOBAL', label: 'üåç Global (Everyone)'},
            {code: 'IN', label: 'üáÆüá≥ India'},
            {code: 'GB', label: 'üá¨üáß United Kingdom'},
            {code: 'US', label: 'üá∫üá∏ United States'},
            {code: 'CA', label: 'üá®üá¶ Canada'},
            {code: 'AU', label: 'üá¶üá∫ Australia'}
        ];
        countries.forEach(c => { %>
            <option value="<%= c.code %>" <%= course.country_code === c.code ? 'selected' : '' %>>
                <%= c.label %>
            </option>
        <% }) %>
    </select>

    <div class="price-grid">
        <div>
            <label style="font-size: 12px; color: #64748b;">Value (INR ‚Çπ)</label>
            <input type="number" name="price_inr" value="<%= course.price_inr || 0 %>" style="margin-bottom: 0;">
        </div>
        <div>
            <label style="font-size: 12px; color: #64748b;">Value (USD $)</label>
            <input type="number" name="price_usd" value="<%= course.price_usd || 0 %>" style="margin-bottom: 0;">
        </div>
    </div>
</div>
            
            <input type="hidden" name="description" id="courseDescriptionInput">

            <label for="editor">Detailed Course Description</label>
            <div id="courseDescriptionEditor" class="editor-container"></div>
            
            <button type="submit" class="btn-primary">üíæ Save Course Details</button>
        </form>

        <hr style="margin: 30px 0;">
        <h3 style="color: #c0392b;">Danger Zone</h3>
        <form action="/admin/delete-course/<%= course.id %>" method="POST" onsubmit="return confirm('Delete this course?');">
            <button type="submit" class="btn-delete" style="width: 100%;">üî• Delete Course</button>
        </form>
    </main>

    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
        var quill = new Quill('#courseDescriptionEditor', { theme: 'snow' });
        
        // Load existing content
        var rawContent = `<%- course.description || '' %>`;
        quill.root.innerHTML = rawContent;
        
        document.getElementById('courseForm').onsubmit = function() {
            document.getElementById('courseDescriptionInput').value = quill.root.innerHTML;
            return true; 
        };
    </script>
</body>
</html>